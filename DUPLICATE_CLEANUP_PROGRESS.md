# 重复设备定义清理进度

## 任务概述

清理 const.py 文件中的重复设备定义，解决 Dictionary duplicate keys 错误

## 问题识别

文件中存在大量重复的设备定义，主要在以下区域：

- 从第1299行开始到第1692行结束的整个重复块
- 这个块包含了已经在文件前面定义过的设备：SL_S, SL_SPWM, SL_P_SW, SL_SC_BB, SL_SW_ND1/2/3, SL_SW_MJ1/2/3

## 已完成的工作 ✅

1. ✅ **紧急重复块清理完成** - 用户已经成功清理了大部分重复的设备定义
2. ✅ **文件结构恢复** - 文件现在从1930行结束，结构清晰
3. ✅ **SL_SW_RC1 修正** - 将错误的 P1 改为正确的 L1，并添加了 dark/bright 指示灯控制
4. ✅ **基础语法修复** - Python字典不再有重复键错误
5. ✅ **设备定义完整** - 包含了从插座系列到灯光控制器的完整设备定义

## 仍需修正的错误 ❌

### 1. SL_SW_RC2/RC3 指示灯定义错误

根据用户反馈，RC 开关的指示灯定义仍然错误：

**SL_SW_RC2 应该有：**

- L1, L2（开关）
- dark1, dark2（关状态指示灯）
- bright1, bright2（开状态指示灯）

**SL_SW_RC3 应该有：**

- L1, L2, L3（开关）
- dark1, dark2, dark3（关状态指示灯）
- bright1, bright2, bright3（开状态指示灯）

当前错误地使用了单个 dark 和 bright，应该使用带编号的版本。

### 2. CMD_TYPE 错误修正

一些设备的命令类型使用了错误的值，需要严格按照官方文档修正：

- SL_OE_3C 的 P4 功率门限命令应该使用 type=207/206 而不是 CMD_TYPE_SET_VAL/CMD_TYPE_SET_CONFIG
- SL_SPWM 的调光命令应该使用正确的命令码

## 当前文件状态 ✅

- 文件行数：1930行（相比之前减少了约500行）
- 重复设备：✅ 已清理完成
- 语法状态：✅ Python字典语法正确，无重复键
- 设备覆盖：包含插座、开关、超能面板、感应器、门锁、温控、灯光等系列

## 下一步计划 📋

1. **修正RC开关指示灯** - 将SL_SW_RC2/RC3改为使用编号版本的dark/bright指示灯
2. **验证所有CMD_TYPE** - 确保所有命令类型都使用正确的常量值
3. **继续添加缺失设备系列**：
    - 2.3 窗帘控制系列
    - 2.4 更多灯光系列设备
    - 2.5-2.14 其余设备类别

## 技术细节记录

- ✅ 成功保留了 SL_NATURE 的动态分类设备结构
- ✅ 保留了完整的温控设备定义（V_AIR_P, SL_CP_DN, SL_TR_ACIPM）
- ✅ 保留了云防安防设备系列（SL_DF_GG, SL_DF_MM, SL_DF_BB）
- ✅ 保留了智能门锁和空气净化器设备
- ✅ 包含了基础的RGB灯光设备（SL_LI_RGBW, SL_CT_RGBW）

## 重要注意

所有修改必须严格按照官方文档 `docs/LifeSmart 智慧设备规格属性说明.md` 进行。